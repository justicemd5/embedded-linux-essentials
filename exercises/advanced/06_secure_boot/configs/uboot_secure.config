#
# U-Boot Secure Boot Configuration Fragment
#
# Apply with: scripts/kconfig/merge_config.sh .config uboot_secure.config
#
# Author: Embedded Linux Labs
# License: MIT

# ============================================================================
# FIT Image Support
# ============================================================================

# Enable FIT image format (required for secure boot)
CONFIG_FIT=y

# Enable signature verification
CONFIG_FIT_SIGNATURE=y

# Enable RSA verification
CONFIG_RSA=y

# RSA key sizes (2048 and 4096 bit)
CONFIG_RSA_PUBLIC_KEY_PARSER=y

# ============================================================================
# Hash Algorithms
# ============================================================================

# SHA-256 for strong hashing
CONFIG_SHA256=y

# Optional: SHA-1 for legacy compatibility (not recommended for new designs)
# CONFIG_SHA1=y

# ============================================================================
# Signature Enforcement
# ============================================================================

# Require verified boot (will fail if signature check fails)
# Only enable after thorough testing!
# CONFIG_FIT_SIGNATURE_ENFORCE=y

# ============================================================================
# Device Tree with Signature
# ============================================================================

# Use external device tree (allows embedding public key)
CONFIG_OF_CONTROL=y
CONFIG_OF_SEPARATE=y

# Or use embedded DTB
# CONFIG_OF_EMBED=y

# ============================================================================
# Crypto Libraries
# ============================================================================

# mbedTLS for crypto operations
CONFIG_MBEDTLS_LIB=y
CONFIG_MBEDTLS_LIB_X509=y

# Or use legacy crypto
# CONFIG_LEGACY_CRYPTO=y

# ============================================================================
# Security Features
# ============================================================================

# Enable secure boot logging (useful for debugging)
CONFIG_LOG=y
CONFIG_LOGLEVEL=7

# Verified boot verbose output
CONFIG_BOOTSTD_FULL=y

# ============================================================================
# Optional: Disable Features for Security
# ============================================================================

# Consider disabling these in production:
# CONFIG_AUTOBOOT_KEYED=y        # Require password for autoboot interrupt
# CONFIG_BOOTDELAY=-2            # Disable boot menu access
# CONFIG_CMD_MEMORY=n            # Disable memory read/write commands

# ============================================================================
# AM335x Specific
# ============================================================================

# BeagleBone Black device tree
CONFIG_DEFAULT_DEVICE_TREE="am335x-boneblack"

# MMC boot support
CONFIG_MMC=y
CONFIG_DM_MMC=y
CONFIG_GENERIC_MMC=y
CONFIG_OMAP_HSMMC=y

# ============================================================================
# Boot Configuration
# ============================================================================

# Autoboot with signed FIT
CONFIG_AUTOBOOT=y
CONFIG_BOOTCOMMAND="fatload mmc 0:1 ${loadaddr} image.fit; bootm ${loadaddr}"

# Load addresses
CONFIG_SYS_LOAD_ADDR=0x82000000
