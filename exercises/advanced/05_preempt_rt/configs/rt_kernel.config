#
# rt_kernel.config - PREEMPT_RT kernel configuration fragment
#
# Merge with kernel config:
#   scripts/kconfig/merge_config.sh .config rt_kernel.config
#   make olddefconfig
#
# Author: Embedded Linux Labs
# License: MIT

# =============================================================================
# PREEMPTION MODEL
# =============================================================================

# Full RT preemption (requires PREEMPT_RT patch)
CONFIG_PREEMPT_RT=y

# Alternative: Use this for mainline kernels (weaker RT guarantees)
# CONFIG_PREEMPT=y
# CONFIG_PREEMPT_VOLUNTARY=n
# CONFIG_PREEMPT_NONE=n

# =============================================================================
# TIMER CONFIGURATION
# =============================================================================

# High-resolution timers (essential for RT)
CONFIG_HIGH_RES_TIMERS=y

# Dynamic tick (NO_HZ) options
CONFIG_NO_HZ_COMMON=y
CONFIG_NO_HZ_IDLE=y

# Full dynticks for isolated CPUs (advanced)
# CONFIG_NO_HZ_FULL=y

# Timer frequency - 1000Hz for best RT resolution
CONFIG_HZ_1000=y
CONFIG_HZ=1000

# =============================================================================
# CPU FREQUENCY
# =============================================================================

# Use performance governor by default (avoids frequency change latency)
CONFIG_CPU_FREQ_DEFAULT_GOV_PERFORMANCE=y
# CONFIG_CPU_FREQ_DEFAULT_GOV_ONDEMAND is not set
# CONFIG_CPU_FREQ_DEFAULT_GOV_POWERSAVE is not set

# =============================================================================
# MEMORY LOCKING
# =============================================================================

# Allow mlockall for RT apps
CONFIG_HAVE_MLOCKED_PAGE_BIT=y

# =============================================================================
# DEBUGGING (Development Only)
# =============================================================================

# These help debug RT issues but add latency - disable for production

# Preemption latency tracer
CONFIG_PREEMPTIRQ_TRACEPOINTS=y
# CONFIG_PREEMPT_TRACER=y
# CONFIG_IRQSOFF_TRACER=y
# CONFIG_PREEMPTOFF_TRACER=y

# Lock debugging (adds significant overhead)
# CONFIG_DEBUG_SPINLOCK=y
# CONFIG_DEBUG_MUTEXES=y
# CONFIG_PROVE_LOCKING=y

# Detect RT deadlocks
# CONFIG_DEBUG_RT_MUTEXES=y

# =============================================================================
# KERNEL FEATURES
# =============================================================================

# RCU configuration for RT
CONFIG_RCU_BOOST=y
CONFIG_RCU_BOOST_DELAY=500

# Threaded interrupt handlers (required for RT)
CONFIG_IRQ_FORCED_THREADING=y

# =============================================================================
# DISABLE LATENCY SOURCES
# =============================================================================

# Disable kernel debug features
# CONFIG_DEBUG_KERNEL is not set
# CONFIG_DEBUG_INFO is not set

# Disable printk during normal operation (use loglevel=0 at boot)
# CONFIG_PRINTK_TIME is not set

# =============================================================================
# BBB-SPECIFIC OPTIONS
# =============================================================================

# Keep AM335x support
CONFIG_SOC_AM33XX=y
CONFIG_ARCH_OMAP2PLUS=y

# I2C (often used, may need RT-safe driver)
CONFIG_I2C=y
CONFIG_I2C_OMAP=y

# SPI
CONFIG_SPI=y
CONFIG_SPI_OMAP24XX=y

# GPIO
CONFIG_GPIO_OMAP=y

# PWM (for motor control)
CONFIG_PWM=y
CONFIG_PWM_TIECAP=y
CONFIG_PWM_TIEHRPWM=y

# PRU-ICSS (for lowest latency GPIO)
CONFIG_PRUSS=y
CONFIG_RPMSG_PRU=y
