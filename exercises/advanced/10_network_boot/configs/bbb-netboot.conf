# dnsmasq configuration for BeagleBone Black network boot
#
# This provides DHCP and TFTP services
#
# Installation:
#   sudo cp bbb-netboot.conf /etc/dnsmasq.d/
#   sudo systemctl restart dnsmasq
#
# Author: Embedded Linux Labs

# ==========================================================================
# INTERFACE BINDING
# ==========================================================================

# Listen only on the interface connected to BeagleBone
# Change this to match your setup
interface=eth1

# Only bind to specified interfaces
bind-interfaces

# Don't listen on loopback
except-interface=lo

# ==========================================================================
# DNS CONFIGURATION
# ==========================================================================

# Don't read /etc/resolv.conf
no-resolv

# Don't poll /etc/resolv.conf for changes
no-poll

# Upstream DNS servers (only needed if BBB needs DNS)
server=8.8.8.8
server=8.8.4.4

# ==========================================================================
# DHCP CONFIGURATION
# ==========================================================================

# Enable DHCP
dhcp-authoritative

# DHCP range and lease time
# Adjust to match your network
dhcp-range=192.168.10.100,192.168.10.200,12h

# Default gateway
dhcp-option=3,192.168.10.1

# DNS servers
dhcp-option=6,8.8.8.8,8.8.4.4

# Subnet mask
dhcp-option=1,255.255.255.0

# Domain name (optional)
dhcp-option=15,bbb.local

# ==========================================================================
# STATIC IP ASSIGNMENTS
# ==========================================================================

# Assign static IPs to specific BeagleBones by MAC address
# Format: dhcp-host=MAC,hostname,IP
# Get MAC with: cat /sys/class/net/eth0/address

# Example entries (uncomment and modify):
# dhcp-host=d0:39:72:aa:bb:cc,bbb-01,192.168.10.50
# dhcp-host=d0:39:72:dd:ee:ff,bbb-02,192.168.10.51
# dhcp-host=d0:39:72:11:22:33,bbb-03,192.168.10.52

# ==========================================================================
# TFTP CONFIGURATION
# ==========================================================================

# Enable built-in TFTP server
enable-tftp

# TFTP root directory
tftp-root=/tftpboot

# Only allow downloads, no uploads
tftp-secure

# Optional: limit TFTP transfer size (in bytes)
# tftp-max=10485760

# ==========================================================================
# PXE/NETWORK BOOT OPTIONS
# ==========================================================================

# TFTP server address (option 66)
dhcp-option=66,192.168.10.1

# Boot filename (option 67)
dhcp-option=67,zImage

# Vendor class for BeagleBone (optional filtering)
# dhcp-vendorclass=set:bbb,AM335x

# ==========================================================================
# LOGGING
# ==========================================================================

# Log DHCP transactions
log-dhcp

# Log DNS queries
log-queries

# Log facility
log-facility=/var/log/dnsmasq.log

# Extra logging for debugging
# log-debug

# ==========================================================================
# ADVANCED OPTIONS
# ==========================================================================

# Don't forward short names
domain-needed

# Don't forward addresses in the non-routed address spaces
bogus-priv

# Read additional hosts from this file
# addn-hosts=/etc/dnsmasq.hosts

# Expand simple names in /etc/hosts with domain suffix
expand-hosts

# Add local domain to hostnames
local=/bbb.local/

# Cache size
cache-size=1000
