#
# U-Boot Fast Boot Configuration for BBB
#
# These settings optimize U-Boot for fastest boot time.
# Apply with: make am335x_evm_defconfig && scripts/kconfig/merge_config.sh
#
# Author: Embedded Linux Labs
# License: MIT

# =============================================================================
# BOOT DELAY
# =============================================================================

# Eliminate boot delay
CONFIG_BOOTDELAY=0

# Or negative for skippable delay
# CONFIG_BOOTDELAY=-2

# =============================================================================
# SILENT CONSOLE (optional)
# =============================================================================

# Silent mode - no console output until Linux
CONFIG_SILENT_CONSOLE=y
CONFIG_SYS_DEVICE_NULLDEV=y
CONFIG_SILENT_CONSOLE_UPDATE_ON_SET=y

# =============================================================================
# REMOVE UNUSED COMMANDS
# =============================================================================

# Disable if not using network boot
# CONFIG_CMD_NET is not set
# CONFIG_CMD_DHCP is not set
# CONFIG_CMD_PING is not set
# CONFIG_CMD_TFTP is not set
# CONFIG_CMD_NFS is not set

# Disable if not using USB boot
# CONFIG_CMD_USB is not set
# CONFIG_USB is not set

# Disable misc commands
# CONFIG_CMD_FPGA is not set
# CONFIG_CMD_XIMG is not set
# CONFIG_CMD_BEDBUG is not set
# CONFIG_CMD_DIAG is not set

# Disable interactive features
# CONFIG_CMD_EDITENV is not set
# CONFIG_CMD_ASKENV is not set

# =============================================================================
# REMOVE UNUSED SUBSYSTEMS
# =============================================================================

# Disable USB stack entirely if not needed
# CONFIG_USB_HOST is not set
# CONFIG_USB_GADGET is not set
# CONFIG_USB_MUSB_HOST is not set
# CONFIG_USB_MUSB_GADGET is not set

# Disable network stack if not needed
# CONFIG_NET is not set
# CONFIG_DM_ETH is not set

# =============================================================================
# FALCON MODE (Advanced)
# =============================================================================

# SPL boots Linux directly, skipping U-Boot proper
# WARNING: Loses U-Boot console and flexibility
CONFIG_SPL_OS_BOOT=y
CONFIG_SPL_FALCON_BOOT_MMCSD=y

# For Falcon Mode, you need to prepare SPL with kernel args:
# spl export fdt <kernel_addr> - <fdt_addr>
# Then saveenv to store the parameters

# =============================================================================
# OPTIMIZE SPL
# =============================================================================

# Minimal SPL for fastest handoff
CONFIG_SPL_DRIVERS_MISC=n
CONFIG_SPL_DM_USB=n
CONFIG_SPL_USB_GADGET=n
CONFIG_SPL_YMODEM_SUPPORT=n

# Keep only what's needed for MMC boot
CONFIG_SPL=y
CONFIG_SPL_MMC=y
CONFIG_SPL_FAT=y
CONFIG_SPL_EXT=n

# =============================================================================
# SIZE OPTIMIZATION
# =============================================================================

# Optimize for size
CONFIG_CC_OPTIMIZE_FOR_SIZE=y

# Use LZO for faster decompression
CONFIG_LZO=y

# =============================================================================
# BBB BOOT SCRIPT OPTIMIZATION
# =============================================================================

# The default BBB boot script searches for many files.
# Create a minimal boot.scr that boots directly:
#
# setenv bootargs console=ttyO0,115200n8 root=/dev/mmcblk0p2 rootwait quiet
# load mmc 0:1 ${loadaddr} zImage
# load mmc 0:1 ${fdtaddr} am335x-boneblack.dtb
# bootz ${loadaddr} - ${fdtaddr}
#
# Compile with:
# mkimage -C none -A arm -T script -d boot.txt boot.scr
